# Введение #

Манифест - xml-файл, описывающий все параметры провайдера. Он должен обязательно называться `anybalance-manifest.xml`. Если это файл не найден в zip архиве провайдера, то он даже не будет показан в списке файлов для установки провайдеров в AnyBalance.

# Структура манифеста #

```
<?xml version="1.0" encoding="utf-8"?>
<provider>
  <id major_version="string" version="integer">provider-text-id</id>
  <name>Название провайдера</name>
  <description>
    Описание провайдера
  </description>
  <author>Author namr &lt;author@email.com&gt;</author>
  <files>
    <icon>icon.png</icon> <!-- файл иконки -->
    <preferences>preferences.xml</preferences> <!-- Файл настроек -->
    <js>main.js</js> <!-- необходим как минимум один файл с функцией main() -->
    <js>lib.js</js> <!-- Можно (необязательно) указывать доп. файлы js -->
    <js target="preferences|parser">preferences.js</js> <!-- Можно (необязательно) перечислить в каких случаях должен включаться файл js (API v.7+) -->
    <history>history.xml</history> <!-- История изменений версий провайдера -->
  </files>
  <counters> <!-- описание счетчиков этого провайдера -->
    <counter id="counter-id" name="Название счетчика" prefix="префикс " suffix=" суффикс" type="counter-type"/>
    <!-- Счетчиков может быть сколько угодно -->
  </counters>
  <keywords>
    <!-- набор слов или фраз, по которым может осуществляться поиск этого провайдера, но которых нет в названии или описании -->
  </keywords>
  <type>
    <!-- некоторый набор ключевых слов для разнесения по каталогам -->
    internet, tv 
  </type>
  <country>
    <!-- перечисление стран, к которым относится этот провайдер, по ISO_3166-1 -->
    ru, ua 
  </country>
</provider>
```

## 

&lt;id&gt;

 ##
Содержит текстовый идентификатор провайдера. Он должен совпадать с названием каталога провайдера в [репозитории](http://code.google.com/p/any-balance-providers/source/browse/#svn%2Ftrunk), так будет гарантироваться его уникальность. В качестве атрибутов у `id` указывается версия провайдера - текстовая (`major_version`) для пользователя и целое число (`version`) для всех. Пользователю будет показываться склеенная версия: `major_version.version`, но все операции по сравнению версий внутри AnyBalance проходят по `version`.

<b>Внимание!</b> Все изменения провайдера, при которых следует опубликовывать провайдер в списке доступных для скачивания, должны сопровождаться **увеличением значения в атрибуте `version`**!

## 

&lt;description&gt;

 ##
Описание провайдера и его функций

## 

&lt;author&gt;

 ##
Автор провайдера и его почта для связи с ним разгневанных и благодарных пользователей :)

## 

&lt;files&gt;

 ##
Содержит список всех файлов, составляющих провайдер, с указанием категории (функции) этого файла. Сейчас есть следующие категории:

### 

&lt;icon&gt;

 ###
Файл, содержащий [иконку провайдера](Icon.md). Делайте его в высоком разрешении, чтобы хорошо выглядел на современных устройствах. Файл с такой категорией может быть только один.

### 

&lt;preferences&gt;

 ###
xml-файл, описывающий [пользовательские настройки провайдера](Preferences.md). Настройки показываются пользователю при настройке аккаунта, основанном на этом провайдере. Выбор пользователя каждый раз передаётся в JavaScript провайдера при запросах счетчиков. Этот файл похож на xml-файлы настроек в Android, но проще. Файл такой категории может быть только один.

### 

&lt;js&gt;

 ###
JavaScript провайдера, достающий откуда-то значения счетчиков и передающий их AnyBalance. Таких файлов может быть несколько, каждый должен быть декларирован в отдельном теге `js`. Но один из файлов обязательно должен определять функцию main(), которая принимает управление при запросе счетчиков.

### 

&lt;history&gt;

 ###
xml-файл, содержащий [историю изменений версий](History.md) провайдеров. Если этот файл присутствует, то при обновлении версии провайдера в AnyBalance пользователю будут показаны изменения в новой версии со времен старой. Введен в AnyBalance v.2.5.521

## 

&lt;counters&gt;

 ##
Определяет список счетчиков - единиц информации, которые предоставляет данный провайдер. Счетчиков может быть сколько угодно, но должен быть как минимум один. Рассмотрим описание счетчика подробнее.

## 

&lt;counter&gt;

 ##
Счетчик должен обязательно иметь `id` и название `name`. Остальные атрибуты опциональные и имеют значения по умолчанию.

  * `name` - определяет, под каким именем счетчик будет виден пользователю.
  * `id` - определяет название переменной в JavaScript, в которой передается значение счетчика.
  * `prefix` - необязательный атрибут, определяющий оформление вывода значения счетчика. `prefix` добавляется перед значением. Например, если определить числовой счетчик с префиксом `prefix="$"`, то значение счетчика в AnyBalance будет отображаться как, например $123.45.
  * `suffix` - необязательный атрибут, определяющий оформление вывода значения счетчика. `suffix` добавляется после значения. Например, если определить числовой счетчик с суффиксом `suffix=" р"`, то значение счетчика в AnyBalance будет отображаться как, например 123.45 р.
  * `units` - синоним `suffix`.

Примечание. `prefix`, `suffix` и `units` могут содержать ссылки на другие счетчики в виде `{@counterid}`. Таким образом, можно динамически подставлять единицы измерения из содержимого других счетчиков. Вместо `{@counterid}` подставляется значение счетчика с `id="counterid"`, обрамленное его префиксом и суффиксом. При этом указанный счетчик не обязан быть декларирован в манифесте. Например, см. [здесь](https://code.google.com/p/any-balance-providers/source/browse/trunk/ab-cell-beeline-russia/anybalance-manifest.xml?spec=svn1949&r=1725#40).

  * `type` - тип счетчика (по-умолчанию `numeric`). Счетчики бывают разных типов, например, численные, текстовые, временные промежутки и др. Поддерживаются следующие типы:
    * `numeric` - числовой, такой счетчик может отображаться на графике, для него высчитывается разница с прошлыми значениями.
    * `text` - текстовый, на графике не отображается, разница значений тоже не считается по понятным причинам.
    * `html` - то же, что и текстовый, но позволяется разметка html. При этом переносы строк воспринимаются только в виде `<br/>`. Поддерживается очень ограниченный набор разметки, `img` не поддерживается. [Список поддерживаемых тэгов](http://commonsware.com/blog/Android/2010/05/26/html-tags-supported-by-textview.html).
    * `time_interval` - измеряемый _в секундах_ числовой счетчик. На графике отображается, разница считается. По умолчанию отображается в виде H:mm:ss, если секунды ненулевые, и в виде целого числа минут, если секунды нулевые. Если формат отображения по-умолчанию не устраивает, то можно явно указать его в атрибуте `format` счетчика. [Подробнее о формате временного интервала](TimeIntervalFormat.md).
    * `time` - дата (миллисекунды с 1970 года). У этого счетчика также можно указать формат отображения [в этом виде](http://docs.oracle.com/javase/1.4.2/docs/api/java/text/SimpleDateFormat.html).
  * `flags` - некоторые флаги, которые влияют на поведение счетчика
    * `zero_when_empty` - в случае отсутствия счетчика в личном кабинете, считать, что он равен 0, записывать это в историю и считать изменения. При отсутствии этого флага (по умолчанию) не найденные в личном кабинете счетчики в историю не записываются, и не изменяют суммы трат и пополнений в статистике.

Для того, чтобы можно было настраивать показ счетчиков, счетчики обязательно должны быть декларированы в манифесте.

## 

&lt;country&gt;

 ##
Перечисление стран по [ISO\_3166-1](http://en.wikipedia.org/wiki/ISO_3166-1). Используется для фильтрации провайдеров по странам в каталоге.